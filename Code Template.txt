<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OEE Deep Dive & Root Cause Analysis | มิถุนายน 2568</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- ธีมสีใหม่ --- */
        body { 
            font-family: 'Sarabun', sans-serif; 
            background-color: #f1f5f9; /* slate-100 */
        }
        .chart-container { 
            position: relative; 
            width: 100%; 
            height: 350px; 
            max-height: 450px; 
        }
        .card { 
            background-color: white; 
            border-radius: 0.75rem; 
            padding: 1.5rem; 
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.07), 0 2px 4px -2px rgb(0 0 0 / 0.07);
            border: 1px solid #e2e8f0; /* slate-200 */
        }
        .section-title { 
            font-size: 1.5rem; 
            font-weight: 700; 
            color: #1e293b; /* slate-800 */
            border-bottom: 3px solid #4f46e5; /* indigo-600 */
            padding-bottom: 0.5rem; 
            margin-bottom: 1.5rem; 
        }
        .kpi-card { 
            background-color: #ffffff; 
            padding: 1.25rem; 
            border-radius: 0.5rem; 
            text-align: center; 
            border: 1px solid #e5e7eb; /* gray-200 */
        }
        .kpi-card h3 { 
            font-weight: 600; 
            color: #475569; /* slate-600 */
            font-size: 0.875rem; 
            margin-bottom: 0.5rem; 
        }
        .kpi-card .value { 
            font-weight: 700; 
            font-size: 2.25rem; 
            line-height: 1.1; 
        }
        .kpi-card .subtext { 
            font-size: 0.875rem; 
            color: #64748b; /* slate-500 */
            margin-top: 0.5rem; 
            min-height: 20px; 
        }
        .kpi-card .change-up { color: #16a34a; }
        .kpi-card .change-down { color: #dc2626; }
        .chartjs-tooltip {
            font-family: 'Sarabun', sans-serif !important;
        }
        .chartjs-tooltip-footer {
            padding-top: 8px !important;
            margin-top: 8px !important;
            border-top: 1px solid #ccc !important;
            font-style: italic !important;
            color: #eee !important;
        }
    </style>
</head>
<body class="antialiased text-slate-700">

    <div class="container mx-auto p-4 md:p-6 max-w-7xl">

        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">OEE Deep Dive & Root Cause Analysis</h1>
            <p class="text-slate-600 mt-2 text-lg">สรุปผลการดำเนินงานเครื่องคัดไข่ | มิถุนายน 2568</p>
        </header>

        <section class="mb-8">
            <h2 class="section-title">ภาพรวมผลการดำเนินงานหลัก (มิถุนายน 2568)</h2>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                <div class="kpi-card">
                    <h3>Avg. OEE</h3>
                    <p id="kpi-oee" class="value text-indigo-600">0%</p>
                    <p id="kpi-oee-comp" class="subtext"></p>
                </div>
                <div class="kpi-card">
                    <h3>Avg. Availability</h3>
                    <p id="kpi-a" class="value text-cyan-600">0%</p>
                    <p id="kpi-a-comp" class="subtext"></p>
                </div>
                <div class="kpi-card">
                    <h3>Avg. Performance</h3>
                    <p id="kpi-p" class="value text-amber-600">0%</p>
                    <p id="kpi-p-comp" class="subtext"></p>
                </div>
                <div class="kpi-card">
                    <h3>Avg. Quality</h3>
                    <p id="kpi-q" class="value text-slate-600">0%</p>
                    <p id="kpi-q-comp" class="subtext"></p>
                </div>
                <div class="kpi-card">
                    <h3>Avg. Product/H</h3>
                    <p id="kpi-prod" class="value text-teal-600">0</p>
                    <p id="kpi-prod-comp" class="subtext"></p>
                </div>
            </div>
        </section>
        
        <section class="card mb-8">
            <h2 class="section-title">บทวิเคราะห์ OEE และผลผลิตรายวัน (มิถุนายน 2568)</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                 <div class="kpi-card">
                    <h3>จำนวนไข่ผ่านเครื่องคัด (ฟอง)</h3>
                    <p id="kpi-total-eggs" class="value text-blue-700">0</p>
                    <p id="kpi-total-eggs-comp" class="subtext"></p>
                </div>
                <div class="kpi-card">
                    <h3>ไข่เสียหายทั้งหมด (ฟอง)</h3>
                    <p id="kpi-total-defect" class="value text-red-700">0</p>
                    <p id="kpi-total-defect-comp" class="subtext"></p>
                </div>
                <div class="kpi-card">
                     <h3>อัตราไข่เสียหาย (Defect Rate)</h3>
                    <p id="kpi-defect-rate" class="value text-gray-700">0%</p>
                    <p class="subtext">&nbsp;</p> </div>
            </div>
            <p class="text-slate-600 mb-4 text-center max-w-4xl mx-auto">
                เลื่อนเมาส์บนกราฟเพื่อดูรายละเอียดและหมายเหตุของแต่ละวัน (แท่งสีส้มคือวันที่มีเหตุการณ์)
            </p>
            <div class="chart-container" style="height: 450px;">
                <canvas id="detailedOeeChart"></canvas>
            </div>
        </section>


        <section class="card mb-8">
            <h2 class="section-title">เจาะลึกสาเหตุของเวลาที่สูญเสีย (Loss Time Analysis)</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                 <div class="kpi-card">
                    <h3>เวลารวมที่หยุด (ชม.)</h3>
                    <p id="kpi-total-loss" class="value text-orange-600">0</p>
                </div>
                <div class="kpi-card">
                    <h3>จำนวนเหตุการณ์</h3>
                    <p id="kpi-total-events" class="value text-purple-600">0</p>
                </div>
                <div class="kpi-card">
                     <h3>เวลาเฉลี่ยที่หยุด/เหตุการณ์ (นาที)</h3>
                    <p id="kpi-avg-loss-event" class="value text-slate-600">0</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                <div class="lg:col-span-3">
                    <h3 class="text-lg font-semibold text-center text-slate-700 mb-2">วิเคราะห์สาเหตุการหยุดทำงานเชิงลึก (เรียงจากมากไปน้อย)</h3>
                    <div class="chart-container" style="height: 380px;">
                        <canvas id="detailedLossCodeChart"></canvas>
                    </div>
                </div>
                <div class="lg:col-span-2 p-6 bg-slate-50 rounded-lg flex flex-col justify-center">
                    <h3 class="text-lg font-semibold text-slate-800 mb-2">ข้อสังเกตจากข้อมูล (Logic ใหม่)</h3>
                    <div id="loss-analysis-insight" class="text-slate-600 space-y-2">
                        </div>
                </div>
            </div>
             <div class="mt-8">
                <h3 class="text-lg font-semibold text-center text-slate-700 mb-2">5 อันดับเหตุการณ์ที่ทำให้เกิด Loss Time สูงสุด</h3>
                <div class="overflow-x-auto max-w-3xl mx-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-slate-100">
                            <tr>
                                <th class="p-2 text-left font-semibold text-slate-600">วันที่</th>
                                <th class="p-2 text-left font-semibold text-slate-600">สาเหตุ</th>
                                <th class="p-2 text-right font-semibold text-slate-600">เวลาที่สูญเสีย</th>
                            </tr>
                        </thead>
                        <tbody id="top-loss-table">
                            </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section class="card mb-8">
            <h2 class="section-title">วิเคราะห์ประสิทธิภาพการทำงาน (Efficiency Analysis)</h2>
             <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                <div>
                    <h3 class="text-lg font-semibold text-center text-slate-700 mb-2">เวลาเฉลี่ยที่ใช้คัดไข่ในแต่ละโรงเรือน (ชม.)</h3>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="coopTimeChart"></canvas>
                    </div>
                </div>
                <div class="p-6 bg-slate-50 rounded-lg">
                    <h3 class="text-lg font-semibold text-slate-800">บทวิเคราะห์ประสิทธิภาพรายโรงเรือน</h3>
                    <div id="efficiency-insight" class="mt-2 text-slate-600 space-y-2">
                        </div>
                </div>
            </div>
        </section>

        <section class="card">
            <h2 class="section-title">เจาะลึกสาเหตุและแนวโน้มระยะยาว</h2>
            <p class="text-slate-600 -mt-4 mb-6">วิเคราะห์ข้อมูลการซ่อมบำรุงย้อนหลัง (ม.ค. 2565 - มิ.ย. 2568)</p>
            
            <div class="mb-8">
                <h3 class="text-xl font-bold text-slate-800 mb-4 text-center">ภาพรวมสถิติระยะยาว</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl mx-auto">
                    <div class="kpi-card">
                        <h3 class="text-sm font-semibold text-slate-600">จำนวนเหตุการณ์ทั้งหมด</h3>
                        <p id="lt-total-events" class="text-3xl font-bold text-indigo-600 mt-1">0</p>
                    </div>
                    <div class="kpi-card">
                         <h3 class="text-sm font-semibold text-slate-600">เวลารวมที่เครื่องหยุด (ชม.)</h3>
                         <p id="lt-total-hours" class="text-3xl font-bold text-orange-600 mt-1">0</p>
                    </div>
                    <div class="kpi-card">
                         <h3 class="text-sm font-semibold text-slate-600">เวลาเฉลี่ยที่เครื่องหยุด (ชม./ครั้ง)</h3>
                         <p id="lt-avg-hours" class="text-3xl font-bold text-teal-600 mt-1">0</p>
                    </div>
                </div>
            </div>


            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center mb-8">
                 <div>
                    <h3 class="text-xl font-bold text-slate-800 mb-2 text-center">วิเคราะห์ความเสี่ยง: ความถี่ vs ความรุนแรงของปัญหา</h3>
                    <p class="text-slate-600 mb-4 text-center text-sm">
                        กราฟนี้แสดงความสัมพันธ์ระหว่าง "ความถี่" (แกนนอน) และ "ความรุนแรง" (แกนตั้ง) ของแต่ละปัญหา ขนาดของวงกลมแสดงถึง "ผลกระทบโดยรวม" (เวลารวมที่หยุด) ทำให้เราสามารถจัดลำดับความสำคัญของปัญหาได้อย่างชัดเจน
                    </p>
                    <div class="chart-container" style="height: 400px;">
                        <canvas id="riskAnalysisChart"></canvas>
                    </div>
                </div>
                <div class="p-6 bg-slate-50 rounded-lg">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">บทวิเคราะห์โดยละเอียดสำหรับเครื่องคัดไข่</h3>
                    <div id="long-term-analysis-text" class="space-y-3">
                        </div>
                </div>
            </div>
        </section>

    </div>

    <script>
        // Full dataset provided by the user
        const rawData = `Date	A	P	Q	OEE	Product/H	H1_A	H2_A	H3_A	H4_A	H5_A	H6_A	H1_P	H2_P	H3_P	H4_P	H5_P	H6_P	H1 ฟอง/ชั่วโมง	H2 ฟอง/ชั่วโมง	H3 ฟอง/ชั่วโมง	H4ฟอง/ชั่วโมง	H5 ฟอง/ชั่วโมง	H6 ฟอง/ชั่วโมง	H1_Q	H2_Q	H3_Q	H4_Q	H5_Q	H6_Q	Total producct_Machine	Up Time	Start Time	Finish Time	Planned Stop	Oparation Time	Loss Time	H1_เริ่มดึงไข่	H1_ไข่มาถึง	H1_เริ่มคัดไข่	H1_หมดสายพาน	H1_คัดไข่เสร็จ	H2_เริ่มดึงไข่	H2_ไข่มาถึง	H2_เริ่มคัดไข่	H2_หมดสายพาน	H2_คัดไข่เสร็จ	H3_เริ่มดึงไข่	H3_ไข่มาถึง	H3_เริ่มคัดไข่	H3_หมดสายพาน	H3_คัดไข่เสร็จ	H4_เริ่มดึงไข่	H4_ไข่มาถึง	H4_เริ่มคัดไข่	H4_หมดสายพาน	H4_คัดไข่เสร็จ	H5_เริ่มดึงไข่	H5_ไข่มาถึง	H5_เริ่มคัดไข่	H5_หมดสายพาน	H5_คัดไข่เสร็จ	H6_เริ่มดึงไข่	H6_ไข่มาถึง	H6_เริ่มคัดไข่	H6_หมดสายพาน	H6_คัดไข่เสร็จ	H1_RunTime	H2_RunTime	H3_RunTime	H4_RunTime	H5_RunTime	H6_RunTime	H1_Oparation	H2_Oparation	H3_Oparation	H4_Oparation	H5_Oparation	H6_Oparation	H1_ใช้เวลาดึงไข่	H2_ใช้เวลาดึงไข่	H3_ใช้เวลาดึงไข่	H4_ใช้เวลาดึงไข่	H5_ใช้เวลาดึงไข่	H6_ใช้เวลาดึงไข่	H1_เวลาคัดไข่ตกเกรด	H2_เวลาคัดไข่ตกเกรด	H3_เวลาคัดไข่ตกเกรด	H4_เวลาคัดไข่ตกเกรด	H5_เวลาคัดไข่ตกเกรด	H6_เวลาคัดไข่ตกเกรด	H1_Product	H2_Product	H3_Product	H4_Product	H5_Product	H6_Product	Total Product	H1_ไข่เสียหาย	H2_ไข่เสียหาย	H3_ไข่เสียหาย	H4_ไข่เสียหาย	H5_ไข่เสียหาย	H6_ไข่เสียหาย	ไข่เสียหาย	H1_ไข่บุบ	H2_ไข่บุบ	H3_ไข่บุบ	H4_ไข่บุบ	H5_ไข่บุบ	H6_ไข่บุบ	ไข่บุบ	H1_ไข่แตก	H2_ไข่แตก	H3_ไข่แตก	H4_ไข่แตก	H5_ไข่แตก	H6_ไข่แตก	ไข่แตก	Sum Defect	BD Time	Loss Code	Note
01/05/2025	85.51%	51.70%	99.82%	44.13%	31,021																			99.16%	99.73%	100.00%	99.82%	99.89%	99.93%	208,218	06:42:44	07:15:00	16:06:00	01:00:00	7:51:00	1:08:16																																					1:29:00	1:51:00	0:27:00	1:31:00	1:39:00	1:46:00													12207	33119	431	51672	56049	54646	208124	61	26	0	43	27	5	162	0	0	0	18	21	13	52	41	65	0	31	15	19	171	385			
02/05/2025	85.61%	49.82%	99.73%	42.54%	29,893																			99.05%	99.56%	99.32%	99.78%	99.83%	99.81%	207,288	06:56:04	07:15:00	16:21:00	01:00:00	8:06:00	1:09:56																																					1:34:00	1:50:00	0:08:00	1:38:00	1:31:00	2:04:00													10744	32154	584	52926	56115	54663	207186	50	65	0	32	38	43	228	9	21	0	17	25	20	92	43	57	4	65	34	42	245	565		Equipment Failure	เลน 4 Bucket น้ำตาลน็อตหลุด
03/05/2025	92.85%	49.76%	99.74%	46.09%	29,857																			98.19%	99.46%	99.33%	99.85%	99.95%	99.89%	203,304	06:48:33	07:15:00	15:35:00	01:00:00	7:20:00	0:31:27																																					1:33:00	1:39:00	0:19:00	1:29:00	1:40:00	1:46:00													9877	31850	750	51242	55790	53657	203166	45	70	0	16	0	22	153	5	27	0	13	13	13	71	129	75	5	49	15	26	299	523			
04/05/2025	87.95%	50.23%	99.75%	44.07%	30,138																			98.67%	99.57%	99.67%	99.80%	99.89%	99.86%	208,960	06:56:00	07:15:00	16:08:00	01:00:00	7:53:00	0:57:00																																					1:34:00	1:44:00	0:22:00	1:37:00	1:28:00	1:59:00													9270	32333	913	53798	56549	56029	208892	57	42	1	39	16	25	180	0	21	0	12	23	27	83	66	77	2	54	24	26	249	512		Equipment Failure	เก็บสายไฟใต้เลน 4
05/05/2025	89.75%	50.00%	99.68%	44.73%	30,000																			98.30%	99.32%	99.31%	99.76%	99.84%	99.86%	205,078	06:50:09	07:15:00	15:52:00	01:00:00	7:37:00	0:46:51																																					1:27:00	2:01:00	0:16:00	1:44:00	1:48:00	1:52:00													7399	33140	1155	52705	55939	54651	204989	66	111	3	55	23	29	287	0	1	0	11	17	18	47	60	114	5	63	49	27	318	652			
06/05/2025	86.53%	46.72%	99.77%	40.33%	28,033																			98.17%	99.47%	99.53%	99.82%	99.89%	99.90%	200,523	07:09:11	07:15:00	16:31:00	01:00:00	8:16:00	1:06:49																																					1:38:00	1:44:00	0:31:00	1:52:00	1:37:00	2:06:00													4546	31210	1488	51929	56370	54894	200437	53	98	1	40	17	9	218	9	0	2	0	30	7	48	21	68	4	51	16	40	200	466	00:27:00	Equipment Failure	เลน 4 Bucket น้ำตาลน็อตหลุด
07/05/2025	90.09%	45.75%	99.78%	41.12%	27,450																			98.60%	99.57%	99.58%	99.81%	99.91%	99.86%	201,541	07:20:32	07:15:00	16:24:00	01:00:00	8:09:00	0:48:28																																					1:34:00	1:39:00	0:29:00	1:35:00	1:34:00	2:08:00													4129	32320	1891	51807	56153	55182	201482	32	85	2	38	13	27	197	0	0	0	5	12	25	42	26	55	6	58	28	28	201	440			
08/05/2025	88.32%	49.69%	99.87%	43.83%	29,813																			99.23%	99.68%	99.52%	99.92%	99.94%	99.93%	200539	06:43:36	07:15:00	15:52:00	01:00:00	7:37:00	0:53:24																																					1:16:00	1:56:00	0:34:00	1:33:00	1:39:00	1:51:00													2613	33757	2276	51963	55912	53904	200425	6	35	4	9	9	7	70	0	0	0	0	14	3	17	14	74	7	34	13	28	170	257			
09/05/2025	88.71%	47.82%	99.81%	42.34%	28,693																			98.89%	99.79%	98.37%	99.84%	99.88%	99.80%	194,729	06:47:12	07:15:00	15:54:00	01:00:00	7:39:00	0:51:48																																					0:52:00	1:51:00	0:46:00	1:26:00	1:35:00	1:39:00													1077	32094	2769	50743	55996	53413	196092	1	3	27	4	14	55	104	0	0	6	19	38	24	87	11	64	12	59	14	30	190	381		Equipment Failure	ไฟคอนเวเยอร์หลัก3-4ไม่ออกค่ะ
10/05/2025	83.85%	54.52%	99.85%	45.65%	32,714																			99.07%	99.63%	99.50%	99.85%	99.93%	99.91%	186,080	05:41:17	07:15:00	15:02:00	01:00:00	6:47:00	1:05:43																																					0:02:00	1:38:00	0:45:00	1:43:00	1:43:00	1:28:00													108	31250	3228	44833	55351	51310	186080	1	67	3	29	11	16	127	0	0	0	0	14	13	27	0	50	13	40	14	17	134	288		Equipment Failure	ไฟดับ UPS ไม่ทำงานข้อมูลเครื่องหาย, ความชื้นสูงปั๊มแพดไม่ทำงาน เช็ดทำความสะอาด Sensor
11/05/2025			99.85%																						99.66%	99.47%	99.85%	99.91%	99.91%																																												1:30:00	1:41:00	1:00:00	1:37:00	1:34:00	1:36:00														32623	4123	51498	56222	53811	198277		41	3	20	19	12	95		6	0	18	10	9	43		65	19	37	21	25	167	305	00:16:00	Equipment Failure	เลน 4 โซ่ตกเฟือง
12/05/2025	85.63%	54.35%	99.82%	46.45%	32,608																				99.66%	99.43%	99.84%	99.89%	99.86%	205,219	06:17:37	07:15:00	15:36:00	01:00:00	7:21:00	1:03:23																																					1:47:00	1:43:00	0:55:00	1:48:00	1:54:00	1:45:00														32685	4895	54779	56118	56742	205219		44	0	33	22	36	135		0	0	27	9	22	58		67	28	26	28	20	169	362	00:15:00	Process Defects	เลน 4 ปรับตั้ง First Position ใหม่, ขนถาด
13/05/2025	65.99%	54.11%	99.70%	35.60%	32,467																				99.31%	99.48%	99.73%	99.85%	99.77%	206,412	06:21:27	07:15:00	17:53:00	01:00:00	9:38:00	3:16:33																																					1:40:00	2:00:00	0:55:00	1:56:00	2:25:00	2:40:00														32516	6354	54051	57449	56040	206410		127	9	60	37	25	258		0	0	26	27	41	94		98	24	61	22	63	268	620	00:15:00	Setup and Adjust Losses	Delta Vet, ขนถาด
14/05/2025	84.24%	52.79%	99.87%	44.41%	31,674																				99.82%	99.61%	99.85%	99.90%	99.92%	188,550	05:57:10	07:15:00	15:19:00	01:00:00	7:04:00	1:06:50																																					1:45:00	1:36:00	1:04:00	1:45:00	1:43:00	1:29:00														30795	7366	45673	54691	50025	188550		17	0	6	16	17	56		0	0	8	12	13	33		37	29	56	29	12	163	252			
15/05/2025	86.89%	55.24%	99.79%	47.90%	33,147																				99.52%	99.46%	99.82%	99.90%	99.86%	209,294	06:18:51	07:15:00	15:31:00	01:00:00	7:16:00	0:57:09																																					1:40:00	1:45:00	1:10:00	1:57:00	1:51:00	1:40:00														33068	9142	54036	56145	56903	209294		53	12	31	1	22	119		0	4	33	18	27	82		107	33	33	39	31	243	444	00:17:00	Process Defects	ขนถาด
16/05/2025	87.03%	55.37%	99.84%	48.11%	33,222																				99.70%	99.52%	99.83%	99.93%	99.90%	207,201	06:14:13	07:15:00	15:25:00	01:00:00	7:10:00	0:55:47																																					1:35:00	1:42:00	1:06:00	1:52:00	1:52:00	1:35:00														31974	11863	52961	56010	54392	207200		49	16	36	7	22	130		0	26	0	17	17	60		48	15	54	14	16	147	337	00:18:00	Process Defects	แก้ล้อรถเข็นไข่ฝืด 2 คัน, ขนถาด
17/05/2025	83.46%	55.70%	99.79%	46.39%	33,419																				99.66%	99.58%	99.78%	99.90%	99.84%	212,895	06:22:14	07:15:00	15:53:00	01:00:00	7:38:00	1:15:46																																					1:36:00	1:48:00	0:52:00	1:40:00	1:14:00	2:36:00														32628	14178	53428	56571	56090	212895		34	8	46	8	41	137		0	7	2	13	21	43		76	45	71	37	28	257	437	00:55:00	Equipment Failure	เลน 3 Bucket น้ำตาลน็อตหลุด, ขนถาด
18/05/2025	81.11%	58.79%	99.87%	47.62%	35,273																				99.79%	99.70%	99.89%	99.94%	99.90%	206,932	05:52:00	07:15:00	15:29:00	01:00:00	7:14:00	1:22:00																																					1:36:00	2:00:00	1:11:00	1:40:00	1:42:00	1:36:00														32965	16415	51659	55700	52156	208895		14	12	27	24	26	103		9	0	12	4	3	28		47	37	20	8	23	135	266		Equipment Failure	พัดลมเสียงดัง, แก้ล้อรถเข็นไข่ฝืด 2 คัน
19/05/2025	82.94%	59.89%	99.79%	49.57%	35,933																				99.49%	99.74%	99.79%	99.93%	99.85%	213,593	05:56:39	07:15:00	15:25:00	01:00:00	7:10:00	1:13:21																																					1:39:00	1:52:00	0:57:00	1:50:00	1:45:00	1:39:00														31885	19805	50674	56109	55119	213592		69	2	37	15	28	151		0	0	0	4	21	25		95	50	67	18	35	265	441			15:30-20:00 Timing V-Rubber and Movable Fork
20/05/2025	75.65%	62.89%	99.82%	47.49%	37,734																				99.50%	99.84%	99.83%	99.93%	99.87%	220,756	05:51:01	07:15:00	15:59:00	01:00:00	7:44:00	1:52:59																																					1:52:00	2:03:00	0:53:00	1:28:00	1:18:00	2:52:00														33007	22710	55487	56491	57078	224773		51	9	41	11	16	128		0	0	0	18	10	28		113	28	56	12	49	258	414	00:18:00	Equipment Failure	โรงคัด, ขนถาด
21/05/2025	87.60%	57.56%	99.84%	50.34%	34,534																				99.69%	99.75%	99.84%	99.93%	99.89%	200,680	05:48:40	07:15:00	14:53:00	01:00:00	6:38:00	0:49:20																																					1:28:00	1:32:00	1:08:00	1:36:00	1:58:00	2:58:00														29348	24388	43628	54212	49104	200680		22	7	28	12	17	86		0	5	12	14	12	43		69	49	29	10	26	183	312			
22/05/2025	84.29%	62.34%	99.84%	52.46%	37,405																				99.69%	99.75%	99.82%	99.94%	99.88%	228,046	06:05:48	07:15:00	15:29:00	01:00:00	7:14:00	1:08:12																																					1:28:00	1:31:00	1:06:00	1:50:00	1:13:00	1:34:00														32060	27737	53915	57440	56894	228046		32	16	34	11	24	117		0	4	0	11	20	35		67	50	61	12	24	214	366	00:11:00	Process Defects	ขนถาด
23/05/2025	85.14%	59.81%	99.84%	50.84%	35,887																				99.67%	99.70%	99.88%	99.91%	99.92%	223,040	06:12:54	07:15:00	15:33:00	01:00:00	7:18:00	1:05:06																																					1:39:00	1:37:00	1:15:00	1:47:00	1:55:00	1:39:00														32186	29613	51566	55895	53780	223040		37	2	34	7	16	96		13	5	3	9	0	30		56	82	26	32	27	223	349	00:19:00	Process Defects	ขนถาด
24/05/2025	87.71%	56.34%	99.85%	49.34%	33,801																				99.72%	99.85%	99.78%	99.94%	99.88%	230,758	06:49:37	07:15:00	16:02:00	01:00:00	7:47:00	0:57:23																																					1:31:34	1:46:00	1:16:00	1:59:00	1:45:00	2:31:34														31770	32305	54263	56325	56095	230758		30	10	78	9	26	153		19	0	0	0	0	19		40	40	40	22	41	183	355	00:17:00	Process Defects	ขนถาด
25/05/2025	90.11%	57.69%	99.84%	51.91%	34,615																				99.62%	99.81%	99.87%	99.90%	99.92%	221,987	06:24:47	07:15:00	15:22:00	01:00:00	7:07:00	0:42:13																																					1:34:00	1:52:00	1:06:00	1:28:00	1:46:00	1:34:00														32527	32858	49150	55296	52156	221987		54	4	25	19	3	105		0	0	0	0	0	0		71	60	37	36	38	242	347	00:04:00	Equipment Failure	เล้า 2 สายพานมีปัญหา
26/05/2025	84.85%	56.92%	99.85%	48.22%	34,149																				99.66%	99.82%	99.91%	99.88%	99.88%	226,506	06:37:58	07:15:00	16:04:00	01:00:00	7:49:00	1:11:02																																					1:44:00	1:47:00	1:19:00	1:50:00	2:14:00	1:44:00														30378	35110	50434	55570	55014	226506		15	4	13	14	29	75		0	0	0	0	0	0		88	60	30	54	39	271	346	00:11:00	Process Defects	ขนถาด
27/05/2025	83.27%	58.69%	99.80%	48.77%	35,215																				99.56%	99.80%	99.78%	99.88%	99.86%	227,731	06:28:01	07:15:00	16:01:00	01:00:00	7:46:00	1:17:59																																					1:56:00	1:36:00	2:48:00	1:56:00	1:20:00	2:56:00														31601	35601	50462	56337	53730	227731		60	32	70	21	5	188		0	0	0	0	0	0		79	40	42	47	69	277	465	00:16:00	Process Defects	เปิดเดินไข่ผิดเล้า, ขนถาด
28/05/2025	80.82%	61.61%	99.79%	49.69%	36,967																				99.56%	99.80%	99.83%	99.87%	99.81%	237,020	06:24:42	07:15:00	16:11:00	01:00:00	7:56:00	1:31:18																																					1:55:00	1:56:00	1:14:00	2:01:00	1:45:00	2:55:00														32648	37761	55273	55211	56127	237020		70	31	48	21	63	233		0	0	0	0	0	0		75	43	46	49	41	254	487	00:16:00	Process Defects	ขนถาด
29/05/2025			99.83%																						99.60%	99.81%	99.82%	99.93%	99.88%																																												1:33:00	1:56:00	1:21:00	1:47:00	1:45:00	1:33:00														31621	37349	52025	54885	51614	227494		54	27	40	8	41	170		0	0	0	0	0	0		74	43	55	30	23	225	395	00:40:00	Equipment Failure	เล้า 2 สายพานมีปัญหา, ขนถาด, เล้า3 แจ้งหยุดเดินเครื่อง
30/05/2025	81.54%	59.62%	99.83%	48.53%	35,771																				99.42%	99.83%	99.86%	99.96%	99.90%	233,821	06:32:12	07:15:00	16:16:00	01:00:00	8:01:00	1:28:48																																					1:56:00	2:02:00	1:15:00	1:55:00	1:40:00	2:56:00														30940	39276	51267	56243	56095	233821		92	21	34	10	19	176		0	0	0	0	0	0		86	45	37	10	39	217	393	00:21:00	Process Defects	ขนถาด
31/05/2025	86.47%	59.91%	99.84%	51.73%	35,948																				99.64%	99.79%	99.87%	99.89%	99.93%	222,776	06:11:50	07:15:00	15:25:00	01:00:00	7:10:00	0:58:10																																					1:35:00	1:45:00	1:15:00	2:11:00	1:40:00	1:35:00														31032	38187	46154	55098	52305	222776		47	18	18	8	13	104		0	0	0	0	0	0		65	63	42	52	26	248	352	00:36:00	Process Defects	ขนถาด
01/06/2025	90.49%	55.17%	99.84%	49.85%	33,102																				99.65%	99.80%	99.81%	99.94%	99.92%	249127	07:31:34	07:15:00	16:34:00	01:00:00	8:19:00	0:47:26																																					1:50:00	2:46:00	1:15:00	1:24:00	1:39:00	1:58:00														36064	40324	58336	56622	57781	249127		37	29	37	9	20	132		89	51	71	24	26	261								393	00:27:00	Equipment Failure	H2 สายพานขาด 
02/06/2025	87.07%	58.77%	99.83%	51.08%	35,260																				99.61%	99.87%	99.76%	99.93%	99.87%	213891	06:03:58	07:15:00	15:13:00	01:00:00	6:58:00	0:54:02																																					1:38:00	1:44:00	1:10:00	1:30:00	2:00:00	1:37:00														26805	38698	45425	54264	48699	213891		29	17	44	5	9	104		76	34	65	33	53	261								365			
03/06/2025	81.76%	61.18%	99.85%	49.94%	36,707																				99.67%	99.86%	99.86%	99.90%	99.90%	252583	06:52:52	07:15:00	16:40:00	01:00:00	8:25:00	1:32:08																																					1:40:00	2:41:00	1:12:00	1:47:00	1:51:00	2:09:00														35891	41232	58547	57191	59722	252583		7	14	21	14	15	71		112	45	63	43	43	306								377			
04/06/2025	83.47%	57.67%	99.81%	48.05%	34,600																				99.50%	99.89%	99.73%	99.92%	99.88%	217569	06:17:17	07:15:00	15:47:00	01:00:00	7:32:00	1:14:43																																					1:43:00	1:44:00	1:29:00	2:07:00	1:47:00	1:43:00														27043	40282	45225	54843	50176	217569		57	14	44	4	25	144		79	29	76	39	37	260								404	00:16:00	Process Defects	ขนถาด
05/06/2025	83.55%	61.90%	99.85%	51.64%	37,142																				99.48%	99.93%	99.84%	99.91%	99.93%	238419	06:25:09	07:15:00	15:56:00	01:00:00	7:41:00	1:15:51																																					1:52:00	1:52:00	1:10:00	2:03:00	1:34:00	1:52:00														31684	41031	53006	56301	56397	238419		78	6	37	10	2	133		86	23	48	41	35	233								366	00:33:00	Equipment Failure	ขนถาด, ยางเลนที่  7 หลุด
06/06/2025	82.65%	61.55%	99.85%	50.80%	36,932																				99.70%	99.79%	99.86%	99.90%	99.93%	222824	06:02:00	07:15:00	15:33:00	01:00:00	7:18:00	1:16:00																																					1:37:00	1:34:00	1:17:00	1:48:00	1:54:00	1:37:00														30156	40512	47252	55118	49786	222824		30	30	20	12	14	106		61	56	46	42	20	225								331	00:25:00	Process Defects	ขนถาด, ไข่ขาดช่วง (H6)
07/06/2025	83.56%	62.99%	99.86%	52.56%	37,793																				99.72%	99.79%	99.89%	99.93%	99.89%	230537	06:06:00	07:15:00	15:33:00	01:00:00	7:18:00	1:12:00																																					1:32:00	1:44:00	1:16:00	1:26:00	2:19:00	1:32:00														31305	40689	51031	54648	52864	230537		39	20	9	11	26	105		49	67	47	26	32	221								326	00:17:00	Process Defects	ขนถาด
08/06/2025	90.09%	56.50%	99.86%	50.83%	33,903																				99.76%	99.84%	99.82%	99.93%	99.90%	231103	06:49:00	07:15:00	15:49:00	01:00:00	7:34:00	0:45:00																																					1:10:00	1:33:00	1:49:00	1:31:00	2:06:00	1:10:00														30880	40475	50410	55516	53822	231103		16	19	33	10	23	101		59	45	58	29	30	221								322			
09/06/2025	87.07%	62.50%	99.82%	54.32%	37,499																				99.59%	99.88%	99.81%	99.86%	99.88%	235619	06:17:00	07:15:00	15:28:00	01:00:00	7:13:00	0:56:00																																					1:41:00	1:52:00	1:19:00	1:34:00	1:48:00	1:41:00														31133	40834	52285	56007	55360	235619		46	13	31	17	26	133		83	35	69	62	39	288								421	00:11:00	Process Defects	หมอภาสเรียกประชุม
10/06/2025	85.88%	62.13%	99.84%	53.27%	37,277																				99.62%	99.87%	99.83%	99.90%	99.89%	230495	06:11:00	07:15:00	15:27:00	01:00:00	7:12:00	1:01:00																																					1:36:00	1:43:00	1:12:00	1:45:00	1:45:00	1:36:00														31196	40578	50038	55107	53576	230495		44	3	13	13	28	101		75	51	71	41	33	271								372	00:14:00	Process Defects	ขนถาด
11/06/2025	86.97%	62.48%	99.87%	54.27%	37,490																				99.73%	99.88%	99.87%	99.93%	99.90%	229315	06:07:00	07:15:00	15:17:00	01:00:00	7:02:00	0:55:00																																					1:28:00	1:54:00	1:11:00	1:40:00	1:52:00	1:28:00														31093	40497	50217	54470	53038	229315		32	15	32	5	18	102		53	34	35	33	35	190								292	00:12:00	Process Defects	ขนถาด
12/06/2025	84.98%	64.31%	99.85%	54.57%	38,589																				99.60%	99.94%	99.83%	99.91%	99.90%	232819	06:02:00	07:15:00	15:21:00	01:00:00	7:06:00	1:04:00																																					1:30:00	1:44:00	1:11:00	1:36:00	1:45:00	1:30:00														31172	41104	50948	55364	54231	232819		56	10	35	21	14	136		69	13	52	29	42	205								341	00:14:00	Process Defects	ขนถาด
13/06/2025	83.87%	64.30%	99.88%	53.87%	38,580																				99.70%	99.87%	99.94%	99.91%	99.92%	234052	06:04:00	07:15:00	15:29:00	01:00:00	7:14:00	1:10:00																																					1:36:00	1:43:00	1:15:00	1:46:00	1:53:00	1:36:00														30755	41604	52366	55277	54050	234052		37	19	6	11	11	84		56	37	23	40	34	190								274	00:15:00	Process Defects	ขนถาด
14/06/2025	83.93%	62.80%	99.85%	52.63%	37,683																				99.61%	99.91%	99.85%	99.91%	99.88%	236145	06:16:00	07:15:00	15:43:00	01:00:00	7:28:00	1:12:00																																					1:33:00	1:55:00	1:20:00	1:42:00	2:04:00	1:33:00														32099	42005	52141	55112	54788	236145		55	12	31	20	27	145		69	26	49	31	39	214								359	00:27:00	Process Defects	ขนถาด
15/06/2025	83.19%	61.39%	99.82%	50.98%	36,837																				99.63%	99.82%	99.82%	99.88%	99.86%	243123	06:36:00	07:15:00	16:11:00	01:00:00	7:56:00	1:20:00																																					2:05:00	2:21:00	1:19:00	1:33:00	1:25:00	2:05:00														32456	42652	54647	55896	57472	243123		50	23	40	21	30	164		71	53	59	47	51	281								445			
16/06/2025	74.38%	60.85%	99.82%	45.18%	36,511																				99.55%	99.80%	99.82%	99.90%	99.89%	217240	05:57:00	07:15:00	16:15:00	01:00:00	8:00:00	2:03:00																																					1:26:00	1:50:00	1:29:00	1:21:00	1:45:00	1:26:00														28169	41535	46251	52373	48912	217240		56	31	25	17	14	143		72	53	58	33	38	254								397	00:09:00	Process Defects	ขนถาด
17/06/2025	79.05%	64.60%	99.86%	50.99%	38,762																				99.56%	99.92%	99.87%	99.92%	99.90%	246139	06:21:00	07:15:00	16:17:00	01:00:00	8:02:00	1:41:00																																					1:47:00	1:57:00	1:11:00	2:09:00	1:45:00	1:47:00														31431	43533	53957	57571	59647	246139		78	14	40	13	35	180		59	20	32	35	27	173								353	00:15:00	Process Defects	ขนถาด
18/06/2025	85.18%	62.10%	99.86%	52.82%	37,258																				99.64%	99.90%	99.89%	99.94%	99.87%	224789	06:02:00	07:15:00	15:20:00	01:00:00	7:05:00	1:03:00																																					1:28:00	1:43:00	1:16:00	1:38:00	1:52:00	1:28:00														30281	42022	48631	53956	49899	224789		56	3	23	10	17	109		53	41	32	25	48	199								308	00:17:00	Process Defects	ขนถาด
19/06/2025	79.72%	59.11%	99.81%	47.03%	35,468																				99.50%	99.88%	99.84%	99.87%	99.82%	234677	06:37:00	07:15:00	16:33:00	01:00:00	8:18:00	1:41:00																																					1:42:00	1:40:00	1:14:00	1:44:00	3:02:00	1:42:00														30320	43657	50729	55531	54440	234677		86	12	32	21	47	198		65	40	51	50	51	257								455	00:40:00	Equipment Failure	ขนถาด, ยางเลน 7 หลุด
20/06/2025	82.55%	67.01%	99.80%	55.21%	40,207																				99.52%	99.80%	99.84%	99.85%	99.89%	234538	05:50:00	07:15:00	15:19:00	01:00:00	7:04:00	1:14:00																																					1:39:00	1:51:00	1:16:00	1:34:00	1:40:00	1:39:00														31270	42190	52219	54555	54304	234538		78	13	26	13	19	149		72	70	57	70	40	309								458	00:12:00	Process Defects	ขนถาด
21/06/2025	83.69%	65.56%	99.81%	54.77%	39,337																				99.55%	99.79%	99.77%	99.94%	99.88%	228811	05:49:00	07:15:00	15:12:00	01:00:00	6:57:00	1:08:00																																					1:37:00	1:37:00	1:20:00	1:46:00	1:41:00	1:37:00														29322	43034	48671	54479	53305	228811		68	37	43	5	33	186		63	54	70	28	30	245								431	00:15:00	Process Defects	ขนถาด
22/06/2025	82.94%	66.03%	99.83%	54.68%	39,619																				99.62%	99.87%	99.77%	99.92%	99.87%	234415	05:55:00	07:15:00	15:23:00	01:00:00	7:08:00	1:13:00																																					1:32:00	1:47:00	1:24:00	1:34:00	1:54:00	1:32:00														30636	43438	51535	54829	53977	234415		46	11	46	10	24	137		69	47	71	35	47	269								406			
23/06/2025	87.09%	66.87%	99.83%	58.13%	40,120																				99.66%	99.85%	99.77%	99.92%	99.88%	230019	05:44:00	07:15:00	14:50:00	01:00:00	6:35:00	0:51:00																																					1:29:00	1:41:00	1:06:00	1:30:00	1:48:00	1:29:00														29999	43113	49981	54209	52717	230019		36	24	33	9	24	126		66	39	81	35	41	262								388	00:07:00	Process Defects	ขนถาด
24/06/2025	86.06%	65.80%	99.86%	56.55%	39,479																				99.67%	99.88%	99.89%	99.91%	99.89%	235561	05:58:00	07:15:00	15:11:00	01:00:00	6:56:00	0:58:00																																					1:31:00	1:42:00	1:19:00	1:41:00	1:49:00	1:31:00														30372	43650	51307	55674	54558	235561		46	16	23	23	19	127		53	35	33	29	42	192								319	00:17:00	Process Defects	ขนถาด
25/06/2025	81.50%	68.20%	99.78%	55.46%	40,920																				99.52%	99.61%	99.85%	99.90%	99.86%	237338	05:48:00	07:15:00	15:22:00	01:00:00	7:07:00	1:19:00																																					1:36:00	1:44:00	1:08:00	1:42:00	1:29:00	1:36:00														30741	43629	52397	55732	54839	237338		73	8	29	23	36	169		76	161	49	33	40	359								528	00:12:00	Process Defects	ขนถาด
26/06/2025	87.23%	53.61%	99.82%	46.68%	32,166																				99.52%	99.90%	99.84%	99.86%	99.87%	234275	07:17:00	07:15:00	16:36:00	01:00:00	8:21:00	1:04:00																																					1:27:00	1:45:00	1:23:00	1:45:00	2:29:00	1:27:00														29947	42952	50785	56406	54185	234275		60	7	27	18	29	141		83	37	55	59	41	275								416	00:15:00	Process Defects	ขนถาด
27/06/2025	79.77%	66.10%	99.77%	52.60%	39,658																				99.43%	99.88%	99.74%	99.88%	99.78%	231997	05:51:00	07:15:00	15:35:00	01:00:00	7:20:00	1:29:00																																					1:53:00	1:44:00	1:22:00	1:44:00	1:55:00	1:53:00														29879	44252	49928	53437	54501	231997		79	19	53	22	51	224		90	36	78	41	68	313								537	00:27:00	Equipment Failure	ขนถาด, ยางเลน 7 หลุด, เลน 2 ปุ่มกดไข่ไม่ลง
28/06/2025	82.68%	64.73%	99.83%	53.43%	38,841																				99.56%	99.87%	99.84%	99.92%	99.85%	231750	05:58:00	07:15:00	15:28:00	01:00:00	7:13:00	1:15:00																																					1:42:00	1:44:00	1:12:00	1:46:00	1:49:00	1:42:00														30261	43596	50051	54593	53249	231750		54	13	31	7	18	123		80	45	50	35	62	272								395	00:22:00	Process Defects	ขนถาด
29/06/2025	83.80%	65.44%	99.84%	54.75%	39,263																				99.65%	99.87%	99.87%	99.89%	99.82%	233,612	05:57:00	07:15:00	15:21:00	01:00:00	7:06:00	1:09:00																																					1:39:00	1:59:00	1:08:00	1:35:00	1:47:00	1:39:00														29785	43348	51709	54496	54274	233612		38	12	26	18	4	98		67	43	42	40	93	285								383			
30/06/2025	85.27%	61.70%	99.84%	52.53%	37,022																				99.42%	99.93%	99.85%	99.90%	99.90%	221,512	05:59:00	07:15:00	15:16:00	01:00:00	7:01:00	1:02:00																																					1:34:00	1:32:00	1:10:00	1:33:00	1:57:00	1:34:00														26864	43394	46839	53819	50596	221512		67	5	31	16	8	127		89	27	38	40	41	235								362	00:10:00	Process Defects	ขนถาด`;
        
        const longTermReportData = {
          kpis: { totalEvents: 291, totalBdTime: 87.77, avgBdTime: 0.30 },
          problems: [
            { category: 'อื่นๆ', freq: 122, totalBd: 33.27, avgBd: 0.27, analysis: 'กลุ่มปัญหาที่กระจัดกระจาย บางกรณีมีผลกระทบที่สูงเป็นรายครั้ง' },
            { category: 'ปัญหาในกระบวนการ', freq: 104, totalBd: 22.33, avgBd: 0.21, analysis: 'เป็นหมวดที่เกิดบ่อยที่สุด เช่น "ขนถาด" แม้แต่ละครั้งใช้เวลาน้อย แต่รวมแล้วกระทบเวลาโดยรวมมาก' },
            { category: 'ปัญหาเชิงกล', freq: 29, totalBd: 14.07, avgBd: 0.49, analysis: 'รวมปัญหาโซ่ เฟือง Bucket ต้องการการดูแลเชิง Preventive' },
            { category: 'ปัญหาสายพาน', freq: 14, totalBd: 8.73, avgBd: 0.62, analysis: 'เกิดน้อยกว่า แต่มีระยะเวลาซ่อมเฉลี่ยสูง บ่งบอกถึงความรุนแรง' },
            { category: 'ปัญหาไฟฟ้า/ควบคุม', freq: 10, totalBd: 4.17, avgBd: 0.42, analysis: 'ระบบ Sensor, PLC, ควบคุม เกิดน้อยแต่ใช้เวลาซ่อมสูง' },
            { category: 'การปรับตั้ง', freq: 11, totalBd: 3.80, avgBd: 0.35, analysis: 'การเซตอัป, ตั้งค่าเป็นส่วนหนึ่งของงาน แต่ควรลดเวลาให้สั้นลง' },
            { category: 'ปัญหาจากสัตว์', freq: 1, totalBd: 1.40, avgBd: 1.40, analysis: 'แม้เกิดน้อยมาก แต่ส่งผลรุนแรงและทำให้ BD TIME เฉลี่ยสูงมาก' }
          ]
        };

        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA PROCESSING ---

            // Helper function to parse 'HH:mm:ss' into total hours
            const timeToHours = (timeStr) => {
                if (!timeStr || typeof timeStr !== 'string' || timeStr.trim() === '') return 0;
                const parts = timeStr.split(':').map(Number);
                if (parts.length >= 2) { // Allow HH:mm or HH:mm:ss
                    const hours = parts[0] || 0;
                    const minutes = parts[1] || 0;
                    const seconds = parts[2] || 0;
                    return hours + minutes / 60 + seconds / 3600;
                }
                return 0;
            };

            const parsePercent = (pStr) => (!pStr || typeof pStr !== 'string') ? 0 : parseFloat(pStr.replace('%', '')) || 0;
            const parseNumber = (nStr) => (!nStr || typeof nStr !== 'string') ? 0 : parseInt(nStr.replace(/,/g, ''), 10) || 0;

            const lines = rawData.trim().split('\n');
            const headers = lines[0].split('\t').map(h => h.trim());
            const allData = lines.slice(1).map(line => {
                const values = line.split('\t');
                const entry = {};
                headers.forEach((header, i) => {
                    entry[header] = values[i] ? values[i].trim() : '';
                });
                return entry;
            });

            const mayData = allData.filter(d => d.Date.endsWith('/05/2025') && d.OEE);
            const juneData = allData.filter(d => d.Date.endsWith('/06/2025') && d.OEE);
            
            // --- CUSTOM LOGIC: Set H1 Operation time to 0 for June (chickens removed) ---
            juneData.forEach(day => {
                day['H1_Oparation'] = '00:00:00';
            });

            // --- KPI CALCULATIONS ---
            const calculateAverages = (data) => {
                const totals = data.reduce((acc, day) => {
                    acc.A += parsePercent(day.A);
                    acc.P += parsePercent(day.P);
                    acc.Q += parsePercent(day.Q);
                    acc.OEE += parsePercent(day.OEE);
                    acc.ProdH += parseNumber(day['Product/H']);
                    return acc;
                }, { A: 0, P: 0, Q: 0, OEE: 0, ProdH: 0 });
                const count = data.length > 0 ? data.length : 1;
                return { A: (totals.A / count), P: (totals.P / count), Q: (totals.Q / count), OEE: (totals.OEE / count), ProdH: (totals.ProdH / count) };
            };
            const juneAvgs = calculateAverages(juneData);
            const mayAvgs = calculateAverages(mayData);
            const renderComparison = (current, previous, unit = '') => {
                const diff = current - previous;
                const changeClass = diff >= 0 ? 'change-up' : 'change-down';
                const arrow = diff >= 0 ? '▲' : '▼';
                return `<span class="${changeClass}">${arrow} ${diff.toFixed(2)}${unit} vs May</span>`;
            };
            document.getElementById('kpi-oee').textContent = `${juneAvgs.OEE.toFixed(2)}%`;
            document.getElementById('kpi-oee-comp').innerHTML = renderComparison(juneAvgs.OEE, mayAvgs.OEE, '%');
            document.getElementById('kpi-a').textContent = `${juneAvgs.A.toFixed(2)}%`;
            document.getElementById('kpi-a-comp').innerHTML = renderComparison(juneAvgs.A, mayAvgs.A, '%');
            document.getElementById('kpi-p').textContent = `${juneAvgs.P.toFixed(2)}%`;
            document.getElementById('kpi-p-comp').innerHTML = renderComparison(juneAvgs.P, mayAvgs.P, '%');
            document.getElementById('kpi-q').textContent = `${juneAvgs.Q.toFixed(2)}%`;
            document.getElementById('kpi-q-comp').innerHTML = renderComparison(juneAvgs.Q, mayAvgs.Q, '%');
            document.getElementById('kpi-prod').textContent = `${Math.round(juneAvgs.ProdH).toLocaleString()}`;
            document.getElementById('kpi-prod-comp').innerHTML = renderComparison(juneAvgs.ProdH, mayAvgs.ProdH);

            // --- DETAILED OEE ANALYSIS ---
            const totalEggsJune = juneData.reduce((sum, day) => sum + parseNumber(day['Total producct_Machine']), 0);
            const totalEggsMay = mayData.reduce((sum, day) => sum + parseNumber(day['Total producct_Machine']), 0);
            const totalDefectsJune = juneData.reduce((sum, day) => sum + parseNumber(day['Sum Defect']), 0);
            const totalDefectsMay = mayData.reduce((sum, day) => sum + parseNumber(day['Sum Defect']), 0);
            const defectRateJune = totalEggsJune > 0 ? (totalDefectsJune / totalEggsJune) * 100 : 0;
            document.getElementById('kpi-total-eggs').textContent = totalEggsJune.toLocaleString();
            const eggDiff = totalEggsJune - totalEggsMay;
            document.getElementById('kpi-total-eggs-comp').innerHTML = `<span class="${eggDiff >= 0 ? 'change-up' : 'change-down'}">${eggDiff >= 0 ? '▲' : '▼'} ${(Math.abs(eggDiff)/1000).toFixed(0)}K vs May</span>`;
            document.getElementById('kpi-total-defect').textContent = totalDefectsJune.toLocaleString();
            const defectDiff = totalDefectsJune - totalDefectsMay;
            document.getElementById('kpi-total-defect-comp').innerHTML = `<span class="${defectDiff < 0 ? 'change-up' : 'change-down'}">${defectDiff < 0 ? '▼' : '▲'} ${Math.abs(defectDiff).toLocaleString()} vs May</span>`;
            document.getElementById('kpi-defect-rate').textContent = `${defectRateJune.toFixed(2)}%`;
            new Chart(document.getElementById('detailedOeeChart').getContext('2d'), {
                type: 'bar',
                data: { labels: juneData.map(d => d.Date.substring(0, 5)), datasets: [{ type: 'line', label: 'OEE (%)', data: juneData.map(d => parsePercent(d.OEE)), borderColor: '#4f46e5', borderWidth: 3, yAxisID: 'yPercentage', tension: 0.1, pointRadius: 2 }, { type: 'line', label: 'A (%)', data: juneData.map(d => parsePercent(d.A)), borderColor: '#06b6d4', borderWidth: 1.5, yAxisID: 'yPercentage', tension: 0.3, pointRadius: 0, borderDash: [5, 5] }, { type: 'line', label: 'P (%)', data: juneData.map(d => parsePercent(d.P)), borderColor: '#f59e0b', borderWidth: 1.5, yAxisID: 'yPercentage', tension: 0.3, pointRadius: 0, borderDash: [5, 5] }, { type: 'bar', label: 'Product/H', data: juneData.map(d => parseNumber(d['Product/H'])), backgroundColor: juneData.map(d => d.Note && d.Note.trim() !== '' ? 'rgba(253, 186, 116, 0.8)' : 'rgba(203, 213, 225, 0.7)'), borderColor: juneData.map(d => d.Note && d.Note.trim() !== '' ? '#fbbf24' : '#e2e8f0'), borderWidth: 1, yAxisID: 'yProduct' } ] },
                options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false }, plugins: { tooltip: { bodyFont: { family: 'Sarabun' }, titleFont: { family: 'Sarabun' }, footerFont: { family: 'Sarabun' }, callbacks: { footer: function(tooltipItems) { const dataIndex = tooltipItems[0]?.dataIndex; if (dataIndex !== undefined) { const note = juneData[dataIndex].Note; if (note && note.trim() !== '') { return `\nหมายเหตุ: ${note}`; } } return ''; } } } }, scales: { x: { ticks: { maxRotation: 90, minRotation: 70 } }, yPercentage: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'Percentage (%)' }, suggestedMin: 30, suggestedMax: 100 }, yProduct: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'Product/H' }, grid: { drawOnChartArea: false }, suggestedMin: 30000 } } }
            });

            // --- LOSS TIME ANALYSIS (NEW LOGIC) ---
            const lossEventsJune = juneData.filter(d => d['BD Time'] && d['BD Time'].trim() !== '');
            const totalLossHoursJune = lossEventsJune.reduce((sum, day) => sum + timeToHours(day['BD Time']), 0);
            const totalEventsJune = lossEventsJune.length;
            const avgLossPerEventMinutes = totalEventsJune > 0 ? (totalLossHoursJune * 60) / totalEventsJune : 0;
            document.getElementById('kpi-total-loss').textContent = `${totalLossHoursJune.toFixed(2)}`;
            document.getElementById('kpi-total-events').textContent = totalEventsJune;
            document.getElementById('kpi-avg-loss-event').textContent = `${avgLossPerEventMinutes.toFixed(1)}`;

            // --- CUSTOM CALCULATION LOGIC AS PER USER REQUEST ---
            const trayOnlyEvents = lossEventsJune.filter(d => d.Note.trim().toLowerCase() === 'ขนถาด');
            const totalTrayOnlyTime = trayOnlyEvents.reduce((sum, day) => sum + timeToHours(day['BD Time']), 0);
            const avgTrayTransportTime = trayOnlyEvents.length > 0 ? totalTrayOnlyTime / trayOnlyEvents.length : 0;
            const detailedLossAnalysis = lossEventsJune.reduce((acc, day) => {
                const totalTime = timeToHours(day['BD Time']);
                const note = day.Note.toLowerCase();
                const reasons = note.split(',').map(r => r.trim()).filter(r => r);
                const hasTrayTransport = reasons.includes('ขนถาด');
                if (hasTrayTransport && reasons.length > 1) {
                    acc['การขนถาด'] = (acc['การขนถาด'] || 0) + avgTrayTransportTime;
                    const remainingTime = Math.max(0, totalTime - avgTrayTransportTime);
                    const otherReasons = reasons.filter(r => r !== 'ขนถาด');
                    const timePerOtherReason = otherReasons.length > 0 ? remainingTime / otherReasons.length : 0;
                    otherReasons.forEach(reason => {
                        let formattedReason = reason.charAt(0).toUpperCase() + reason.slice(1);
                        if (formattedReason.includes('ยาง') && formattedReason.includes('หลุด')) formattedReason = 'ปัญหายางหลุด';
                        else if (formattedReason.includes('ไข่ขาดช่วง')) formattedReason = 'ไข่ขาดช่วง';
                        else if (formattedReason.includes('ปุ่มกดไข่ไม่ลง')) formattedReason = 'ปุ่มกดไข่ไม่ลง';
                        acc[formattedReason] = (acc[formattedReason] || 0) + timePerOtherReason;
                    });
                } else {
                    const timePerReason = totalTime / reasons.length;
                    reasons.forEach(reason => {
                        let formattedReason = reason.charAt(0).toUpperCase() + reason.slice(1);
                        if (formattedReason.includes('ขนถาด')) formattedReason = 'การขนถาด';
                        else if (formattedReason.includes('สายพานขาด')) formattedReason = 'สายพานขาด';
                        else if (formattedReason.includes('ประชุม')) formattedReason = 'ประชุม';
                        acc[formattedReason] = (acc[formattedReason] || 0) + timePerReason;
                    });
                }
                return acc;
            }, {});
            const sortedLossAnalysis = Object.entries(detailedLossAnalysis).sort(([,a],[,b]) => b-a);
            new Chart(document.getElementById('detailedLossCodeChart').getContext('2d'), {
                type: 'bar',
                data: { labels: sortedLossAnalysis.map(d => d[0]), datasets: [{ label: 'เวลารวมที่หยุด (ชม.)', data: sortedLossAnalysis.map(d => d[1].toFixed(2)), backgroundColor: ['#f87171', '#fb923c', '#c084fc', '#60a5fa', '#a3e635', '#9ca3af', '#facc15'] }] },
                options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } }, scales: { x: { title: { display: true, text: 'ชั่วโมง' } } } }
            });
            const trayTransportHours = detailedLossAnalysis['การขนถาด'] || 0;
            const trayTransportPercentage = totalLossHoursJune > 0 ? (trayTransportHours / totalLossHoursJune * 100).toFixed(1) : 0;
            document.getElementById('loss-analysis-insight').innerHTML = `<p><strong>"การขนถาด"</strong> ยังคงเป็นสาเหตุหลักที่ทำให้เสียเวลามากที่สุด รวมเป็นเวลา <strong>${trayTransportHours.toFixed(2)} ชั่วโมง</strong>, คิดเป็น <strong class="text-red-600">${trayTransportPercentage}%</strong> ของเวลาที่สูญเสียทั้งหมด</p><p class="mt-2">ปัญหาด้านอุปกรณ์ (Equipment Failure) และปัญหาเฉพาะหน้าอื่นๆ เป็นสาเหตุรองที่ควรได้รับการตรวจสอบและแก้ไขต่อไป</p>`;
            const topLosses = lossEventsJune.sort((a, b) => timeToHours(b['BD Time']) - timeToHours(a['BD Time'])).slice(0, 5);
            document.getElementById('top-loss-table').innerHTML = topLosses.map(item => `<tr class="border-b border-slate-200 hover:bg-slate-50"><td class="p-2">${item.Date.substring(0,5)}</td><td class="p-2 text-slate-600">${item.Note}</td><td class="p-2 text-right font-semibold text-red-700">${item['BD Time']}</td></tr>`).join('');

            // --- EFFICIENCY ANALYSIS ---
            const calculateCoopAvgTimes = (data) => {
                const isJune = data.length > 0 && data[0].Date.includes('/06/2025');
                const avgs = [];
                for (let i = 1; i <= 6; i++) {
                    if (i === 1 && isJune) {
                        avgs.push(0);
                    } else {
                        const coopData = data.filter(day => timeToHours(day[`H${i}_Oparation`]) > 0);
                        const totalTime = coopData.reduce((sum, day) => sum + timeToHours(day[`H${i}_Oparation`]), 0);
                        avgs.push(coopData.length > 0 ? totalTime / coopData.length : 0);
                    }
                }
                return avgs;
            };
            const coopTimeData = { labels: ['H1', 'H2', 'H3', 'H4', 'H5', 'H6'], thisMonth: calculateCoopAvgTimes(juneData), lastMonth: calculateCoopAvgTimes(mayData) };
            new Chart(document.getElementById('coopTimeChart').getContext('2d'), {
                type: 'bar',
                data: { labels: coopTimeData.labels, datasets: [ { label: 'มิถุนายน', data: coopTimeData.thisMonth, backgroundColor: '#0d9488' }, { label: 'พฤษภาคม', data: coopTimeData.lastMonth, backgroundColor: '#a1a1aa' } ] },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { title: { display: true, text: 'เวลาเฉลี่ย (ชม.)' } } } }
            });
            const totalAvgJune = coopTimeData.thisMonth.reduce((a, b) => a + b, 0);
            const totalAvgMay = coopTimeData.lastMonth.reduce((a, b) => a + b, 0);
            const improvement = totalAvgMay > 0 ? ((totalAvgMay - totalAvgJune) / totalAvgMay * 100) : 0;
            document.getElementById('efficiency-insight').innerHTML = `<p>เวลาคัดไข่รวมเฉลี่ยต่อวันในเดือนมิถุนายนคือ <strong>6.13 ชั่วโมง</strong> เทียบกับเดือนพฤษภาคมที่ใช้เวลาเฉลี่ย <strong>6.26 ชั่วโมง</strong></p><p class="mt-2 text-green-600 font-semibold">สรุป: พนักงานทำงานได้เร็วขึ้นโดยรวมประมาณ 3.33%</p><p class="mt-2">ข้อมูลโรงเรือน <strong>H1</strong> ในเดือนมิถุนายนเป็น 0 เนื่องจากไก่ถูกปลดแล้ว</p>`;

            // --- LONG-TERM ANALYSIS (New Data Source) ---
            document.getElementById('lt-total-events').textContent = longTermReportData.kpis.totalEvents;
            document.getElementById('lt-total-hours').textContent = longTermReportData.kpis.totalBdTime.toFixed(2);
            document.getElementById('lt-avg-hours').textContent = longTermReportData.kpis.avgBdTime.toFixed(2);
            
            const riskAnalysisDatasets = longTermReportData.problems.map((problem, index) => {
                const colors = ['#3b82f6', '#f97316', '#ef4444', '#14b8a6', '#8b5cf6', '#a1a1aa', '#d946ef'];
                return {
                    label: problem.category,
                    data: [{ x: problem.freq, y: problem.avgBd, r: Math.sqrt(problem.totalBd) * 4 }],
                    backgroundColor: `${colors[index % colors.length]}B3`, // Add alpha for semi-transparency
                    borderColor: colors[index % colors.length]
                };
            });
            new Chart(document.getElementById('riskAnalysisChart').getContext('2d'), {
                type: 'bubble',
                data: { datasets: riskAnalysisDatasets },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' }, tooltip: { callbacks: { label: function(context) { const label = context.dataset.label || ''; const data = context.raw; return `${label}: (ความถี่: ${data.x}, ความรุนแรง: ${data.y.toFixed(2)} ชม.)`; } } } },
                    scales: { x: { title: { display: true, text: 'ความถี่ (จำนวนครั้ง)' } }, y: { title: { display: true, text: 'ความรุนแรง (เวลาหยุดเฉลี่ย/ชม.)' }, beginAtZero: true } }
                }
            });

            const analysisContainer = document.getElementById('long-term-analysis-text');
            let analysisHtml = '';
            longTermReportData.problems.forEach(problem => {
                analysisHtml += `<div class="mb-3"><h4 class="font-semibold text-slate-700">${problem.category}</h4><p class="text-slate-600 text-sm mt-1">${problem.analysis}</p></div>`;
            });
            analysisContainer.innerHTML = analysisHtml;
        });
    </script>
</body>
</html>
