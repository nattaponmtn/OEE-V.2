<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OEE Deep Dive & Root Cause Analysis | กรกฎาคม 2568</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 350px;
            max-height: 450px;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.07), 0 2px 4px -2px rgb(0 0 0 / 0.07);
            border: 1px solid #e2e8f0; /* slate-200 */
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b; /* slate-800 */
            border-bottom: 3px solid #4f46e5; /* indigo-600 */
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .kpi-card {
            background-color: #ffffff;
            padding: 1.25rem;
            border-radius: 0.5rem;
            text-align: center;
            border: 1px solid #e5e7eb; /* gray-200 */
        }
        .kpi-card h3 {
            font-weight: 600;
            color: #475569; /* slate-600 */
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        .kpi-card .value {
            font-weight: 700;
            font-size: 2.25rem;
            line-height: 1.1;
        }
        .kpi-card .subtext {
            font-size: 0.875rem;
            color: #64748b; /* slate-500 */
            margin-top: 0.5rem;
            min-height: 20px;
        }
        .kpi-card .change-up { color: #16a34a; }
        .kpi-card .change-down { color: #dc2626; }
        .chartjs-tooltip {
            font-family: 'Sarabun', sans-serif !important;
        }
        .chartjs-tooltip-footer {
            padding-top: 8px !important;
            margin-top: 8px !important;
            border-top: 1px solid #ccc !important;
            font-style: italic !important;
            color: #eee !important;
        }
    </style>
</head>
<body class="antialiased text-slate-700">

    <div class="container mx-auto p-4 md:p-6 max-w-7xl">

        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">OEE Deep Dive & Root Cause Analysis</h1>
            <p class="text-slate-600 mt-2 text-lg">สรุปผลการดำเนินงานเครื่องคัดไข่ | กรกฎาคม 2568</p>
        </header>

        <section class="mb-8">
            <h2 class="section-title">ภาพรวมผลการดำเนินงานหลัก (กรกฎาคม 2568)</h2>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                <div class="kpi-card">
                    <h3>Avg. OEE</h3>
                    <p id="kpi-oee" class="value text-indigo-600">0%</p>
                    <p id="kpi-oee-comp" class="subtext"></p>
                </div>
                <div class="kpi-card">
                    <h3>Avg. Availability</h3>
                    <p id="kpi-a" class="value text-cyan-600">0%</p>
                    <p id="kpi-a-comp" class="subtext"></p>
                </div>
                <div class="kpi-card">
                    <h3>Avg. Performance</h3>
                    <p id="kpi-p" class="value text-amber-600">0%</p>
                    <p id="kpi-p-comp" class="subtext"></p>
                </div>
                <div class="kpi-card">
                    <h3>Avg. Quality</h3>
                    <p id="kpi-q" class="value text-slate-600">0%</p>
                    <p id="kpi-q-comp" class="subtext"></p>
                </div>
                <div class="kpi-card">
                    <h3>Avg. Product/H</h3>
                    <p id="kpi-prod" class="value text-teal-600">0</p>
                    <p id="kpi-prod-comp" class="subtext"></p>
                </div>
            </div>
        </section>
        
        <section class="card mb-8">
            <h2 class="section-title">บทวิเคราะห์ OEE และผลผลิตรายวัน (กรกฎาคม 2568)</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                 <div class="kpi-card">
                    <h3>จำนวนไข่ผ่านเครื่องคัด (ฟอง)</h3>
                    <p id="kpi-total-eggs" class="value text-blue-700">0</p>
                    <p id="kpi-total-eggs-comp" class="subtext"></p>
                </div>
                <div class="kpi-card">
                    <h3>ไข่เสียหายทั้งหมด (ฟอง)</h3>
                    <p id="kpi-total-defect" class="value text-red-700">0</p>
                    <p id="kpi-total-defect-comp" class="subtext"></p>
                </div>
                <div class="kpi-card">
                    <h3>อัตราไข่เสียหาย (Defect Rate)</h3>
                    <p id="kpi-defect-rate" class="value text-gray-700">0%</p>
                    <p class="subtext">&nbsp;</p> </div>
            </div>
            <p class="text-slate-600 mb-4 text-center max-w-4xl mx-auto">
                เลื่อนเมาส์บนกราฟเพื่อดูรายละเอียดและหมายเหตุของแต่ละวัน (แท่งสีส้มคือวันที่มีเหตุการณ์)
            </p>
            <div class="chart-container" style="height: 450px;">
                <canvas id="detailedOeeChart"></canvas>
            </div>
        </section>


        <section class="card mb-8">
            <h2 class="section-title">เจาะลึกสาเหตุของเวลาที่สูญเสีย (Loss Time Analysis)</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                 <div class="kpi-card">
                    <h3>เวลารวมที่หยุด (ชม.)</h3>
                    <p id="kpi-total-loss" class="value text-orange-600">0</p>
                </div>
                <div class="kpi-card">
                    <h3>จำนวนเหตุการณ์</h3>
                    <p id="kpi-total-events" class="value text-purple-600">0</p>
                </div>
                <div class="kpi-card">
                    <h3>เวลาเฉลี่ยที่หยุด/เหตุการณ์ (นาที)</h3>
                    <p id="kpi-avg-loss-event" class="value text-slate-600">0</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                <div class="lg:col-span-3">
                    <h3 class="text-lg font-semibold text-center text-slate-700 mb-2">วิเคราะห์สาเหตุการหยุดทำงานเชิงลึก (เรียงจากมากไปน้อย)</h3>
                    <div class="chart-container" style="height: 380px;">
                        <canvas id="detailedLossCodeChart"></canvas>
                    </div>
                </div>
                <div class="lg:col-span-2 p-6 bg-slate-50 rounded-lg flex flex-col justify-center">
                    <h3 class="text-lg font-semibold text-slate-800 mb-2">ข้อสังเกตจากข้อมูล</h3>
                    <div id="loss-analysis-insight" class="text-slate-600 space-y-2">
                    </div>
                </div>
            </div>
             <div class="mt-8">
                <h3 class="text-lg font-semibold text-center text-slate-700 mb-2">5 อันดับเหตุการณ์ที่ทำให้เกิด Loss Time สูงสุด</h3>
                <div class="overflow-x-auto max-w-3xl mx-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-slate-100">
                            <tr>
                                <th class="p-2 text-left font-semibold text-slate-600">วันที่</th>
                                <th class="p-2 text-left font-semibold text-slate-600">สาเหตุ</th>
                                <th class="p-2 text-right font-semibold text-slate-600">เวลาที่สูญเสีย</th>
                            </tr>
                        </thead>
                        <tbody id="top-loss-table">
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section class="card">
            <h2 class="section-title">วิเคราะห์ประสิทธิภาพการทำงาน (Efficiency Analysis)</h2>
             <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                <div>
                    <h3 class="text-lg font-semibold text-center text-slate-700 mb-2">เวลาเฉลี่ยที่ใช้คัดไข่ในแต่ละโรงเรือน (ชม.)</h3>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="coopTimeChart"></canvas>
                    </div>
                </div>
                <div class="p-6 bg-slate-50 rounded-lg">
                    <h3 class="text-lg font-semibold text-slate-800">บทวิเคราะห์ประสิทธิภาพรายโรงเรือน</h3>
                    <div id="efficiency-insight" class="mt-2 text-slate-600 space-y-2">
                    </div>
                </div>
            </div>
        </section>

    </div>

    <script>
        // --- CHART INSTANCES ---
        let detailedOeeChartInstance, detailedLossCodeChartInstance, coopTimeChartInstance;

        // --- DATA FETCHING AND PROCESSING ---
        async function fetchDataAndRender() {
            const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRlpC6mhBM2bPVYgz5pS6PAIW9Brzs6GAOH0wwFpfxB6eK_L5InKpqIcSusdOlRSLZ0swhFlqBiysx8/pub?gid=565758569&single=true&output=csv';
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Network response was not ok: ${response.statusText}`);
                }
                const csvText = await response.text();
                processData(csvText);
            } catch (error) {
                console.error("Failed to fetch or process data:", error);
                document.body.innerHTML = `<div class="p-8 text-center text-red-600"><h3>เกิดข้อผิดพลาดในการโหลดข้อมูล</h3><p>${error.message}</p></div>`;
            }
        }

        function processData(csvText) {
            // --- DATA PARSING ---
            function parseCsv(text) {
                const lines = text.trim().replace(/\r/g, "").split('\n');
                const headers = lines[0].split(',').map(h => h.trim());
                const data = lines.slice(1).map(line => {
                    const values = [];
                    let current = '';
                    let inQuotes = false;
                    for (let char of line) {
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            values.push(current);
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    values.push(current);
                    
                    const entry = {};
                    headers.forEach((header, i) => {
                        entry[header] = values[i] ? values[i].trim() : '';
                    });
                    return entry;
                });
                return data;
            }

            const allData = parseCsv(csvText);

            // --- HELPER FUNCTIONS ---
            const timeToHours = (timeStr) => {
                if (!timeStr || typeof timeStr !== 'string' || timeStr.trim() === '') return 0;
                const parts = timeStr.split(':').map(Number);
                if (parts.length >= 2) {
                    const hours = parts[0] || 0;
                    const minutes = parts[1] || 0;
                    const seconds = parts[2] || 0;
                    return hours + minutes / 60 + seconds / 3600;
                }
                return 0;
            };
            const parsePercent = (pStr) => (!pStr || typeof pStr !== 'string') ? 0 : parseFloat(pStr.replace('%', '')) || 0;
            const parseNumber = (nStr) => (!nStr || typeof nStr !== 'string') ? 0 : parseInt(String(nStr).replace(/,/g, ''), 10) || 0;

            // --- FILTER DATA FOR RELEVANT MONTHS ---
            const julyData = allData.filter(d => d.Date && d.Date.includes('/07/2025'));
            const juneData = allData.filter(d => d.Date && d.Date.includes('/06/2025'));
            
            const julyDataWithOEE = julyData.filter(d => d.OEE);
            const juneDataWithOEE = juneData.filter(d => d.OEE);

            // --- CUSTOM LOGIC: Set H1 Operation time to 0 for June/July (chickens removed) ---
            [...julyData, ...juneData, ...julyDataWithOEE, ...juneDataWithOEE].forEach(day => {
                day['H1_Oparation'] = '00:00:00';
            });

            // --- KPI CALCULATIONS ---
            const calculateAverages = (data) => {
                if (!data || data.length === 0) return { A: 0, P: 0, Q: 0, OEE: 0, ProdH: 0 };
                const totals = data.reduce((acc, day) => {
                    acc.A += parsePercent(day.A);
                    acc.P += parsePercent(day.P);
                    acc.Q += parsePercent(day.Q);
                    acc.OEE += parsePercent(day.OEE);
                    acc.ProdH += parseNumber(day['Product/H']);
                    return acc;
                }, { A: 0, P: 0, Q: 0, OEE: 0, ProdH: 0 });
                const count = data.length;
                return { A: (totals.A / count), P: (totals.P / count), Q: (totals.Q / count), OEE: (totals.OEE / count), ProdH: (totals.ProdH / count) };
            };
            const julyAvgs = calculateAverages(julyDataWithOEE);
            const juneAvgs = calculateAverages(juneDataWithOEE);
            const renderComparison = (current, previous, unit = '', higherIsBetter = true) => {
                const diff = current - previous;
                let changeClass = '';
                if (diff !== 0) {
                    if (higherIsBetter) {
                        changeClass = diff > 0 ? 'change-up' : 'change-down';
                    } else {
                        changeClass = diff < 0 ? 'change-up' : 'change-down';
                    }
                }
                const arrow = diff >= 0 ? '▲' : '▼';
                return `<span class="${changeClass}">${arrow} ${Math.abs(diff).toFixed(2)}${unit} vs Jun</span>`;
            };
            document.getElementById('kpi-oee').textContent = `${julyAvgs.OEE.toFixed(2)}%`;
            document.getElementById('kpi-oee-comp').innerHTML = renderComparison(julyAvgs.OEE, juneAvgs.OEE, '%');
            document.getElementById('kpi-a').textContent = `${julyAvgs.A.toFixed(2)}%`;
            document.getElementById('kpi-a-comp').innerHTML = renderComparison(julyAvgs.A, juneAvgs.A, '%');
            document.getElementById('kpi-p').textContent = `${julyAvgs.P.toFixed(2)}%`;
            document.getElementById('kpi-p-comp').innerHTML = renderComparison(julyAvgs.P, juneAvgs.P, '%');
            document.getElementById('kpi-q').textContent = `${julyAvgs.Q.toFixed(2)}%`;
            document.getElementById('kpi-q-comp').innerHTML = renderComparison(julyAvgs.Q, juneAvgs.Q, '%');
            document.getElementById('kpi-prod').textContent = `${Math.round(julyAvgs.ProdH).toLocaleString()}`;
            document.getElementById('kpi-prod-comp').innerHTML = renderComparison(julyAvgs.ProdH, juneAvgs.ProdH);

            // --- DETAILED OEE ANALYSIS ---
            const totalEggsJuly = julyData.reduce((sum, day) => sum + parseNumber(day['Total Product']), 0);
            const totalDefectsJuly = julyData.reduce((sum, day) => sum + parseNumber(day['Sum Defect']), 0);
            const totalEggsJune = juneData.reduce((sum, day) => sum + parseNumber(day['Total Product']), 0);
            const totalDefectsJune = juneData.reduce((sum, day) => sum + parseNumber(day['Sum Defect']), 0);
            const defectRateJuly = totalEggsJuly > 0 ? (totalDefectsJuly / totalEggsJuly) * 100 : 0;
            
            document.getElementById('kpi-total-eggs').textContent = totalEggsJuly.toLocaleString();
            document.getElementById('kpi-total-eggs-comp').innerHTML = renderComparison(totalEggsJuly, totalEggsJune, ' ฟอง');
            document.getElementById('kpi-total-defect').textContent = totalDefectsJuly.toLocaleString();
            document.getElementById('kpi-total-defect-comp').innerHTML = renderComparison(totalDefectsJuly, totalDefectsJune, ' ฟอง', false);
            document.getElementById('kpi-defect-rate').textContent = `${defectRateJuly.toFixed(2)}%`;
            
            if (detailedOeeChartInstance) detailedOeeChartInstance.destroy();
            detailedOeeChartInstance = new Chart(document.getElementById('detailedOeeChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: julyDataWithOEE.map(d => d.Date.substring(0, 5)),
                    datasets: [
                        { type: 'line', label: 'OEE (%)', data: julyDataWithOEE.map(d => parsePercent(d.OEE)), borderColor: '#4f46e5', borderWidth: 3, yAxisID: 'yPercentage', tension: 0.1, pointRadius: 2 },
                        { type: 'line', label: 'A (%)', data: julyDataWithOEE.map(d => parsePercent(d.A)), borderColor: '#06b6d4', borderWidth: 1.5, yAxisID: 'yPercentage', tension: 0.3, pointRadius: 0, borderDash: [5, 5] },
                        { type: 'line', label: 'P (%)', data: julyDataWithOEE.map(d => parsePercent(d.P)), borderColor: '#f59e0b', borderWidth: 1.5, yAxisID: 'yPercentage', tension: 0.3, pointRadius: 0, borderDash: [5, 5] },
                        { type: 'bar', label: 'Product/H', data: julyDataWithOEE.map(d => parseNumber(d['Product/H'])), backgroundColor: julyDataWithOEE.map(d => d.Note && d.Note.trim() !== '' ? 'rgba(253, 186, 116, 0.8)' : 'rgba(203, 213, 225, 0.7)'), borderColor: julyDataWithOEE.map(d => d.Note && d.Note.trim() !== '' ? '#fbbf24' : '#e2e8f0'), borderWidth: 1, yAxisID: 'yProduct' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false }, plugins: { tooltip: { bodyFont: { family: 'Sarabun' }, titleFont: { family: 'Sarabun' }, footerFont: { family: 'Sarabun' }, callbacks: { footer: function(tooltipItems) { const dataIndex = tooltipItems[0]?.dataIndex; if (dataIndex !== undefined) { const note = julyDataWithOEE[dataIndex].Note; if (note && note.trim() !== '') { return `\nหมายเหตุ: ${note}`; } } return ''; } } } }, scales: { x: { ticks: { maxRotation: 90, minRotation: 70 } }, yPercentage: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'Percentage (%)' }, suggestedMin: 30, suggestedMax: 100 }, yProduct: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'Product/H' }, grid: { drawOnChartArea: false }, suggestedMin: 30000 } } }
            });

            // --- LOSS TIME ANALYSIS ---
            const lossEventsJuly = julyData.filter(d => d['BD Time'] && d['BD Time'].trim() !== '');
            const totalLossHoursJuly = lossEventsJuly.reduce((sum, day) => sum + timeToHours(day['BD Time']), 0);
            const totalEventsJuly = lossEventsJuly.length;
            const avgLossPerEventMinutes = totalEventsJuly > 0 ? (totalLossHoursJuly * 60) / totalEventsJuly : 0;
            document.getElementById('kpi-total-loss').textContent = `${totalLossHoursJuly.toFixed(2)}`;
            document.getElementById('kpi-total-events').textContent = totalEventsJuly;
            document.getElementById('kpi-avg-loss-event').textContent = `${avgLossPerEventMinutes.toFixed(1)}`;

            const detailedLossAnalysis = lossEventsJuly.reduce((acc, day) => {
                const totalTime = timeToHours(day['BD Time']);
                const reasons = day.Note.split(',').map(r => r.trim()).filter(r => r);
                const timePerReason = reasons.length > 0 ? totalTime / reasons.length : 0;
                reasons.forEach(reason => {
                    let formattedReason = reason.charAt(0).toUpperCase() + reason.slice(1);
                    if (formattedReason.toLowerCase().includes('ขนถาด')) formattedReason = 'การขนถาด';
                    else if (formattedReason.toLowerCase().includes('ซ่อมเลน')) formattedReason = 'ซ่อมแซมเลน';
                    else if (formattedReason.toLowerCase().includes('ไฟดับ')) formattedReason = 'ไฟฟ้าดับ';
                    acc[formattedReason] = (acc[formattedReason] || 0) + timePerReason;
                });
                return acc;
            }, {});
            const sortedLossAnalysis = Object.entries(detailedLossAnalysis).sort(([,a],[,b]) => b-a);
            
            if (detailedLossCodeChartInstance) detailedLossCodeChartInstance.destroy();
            detailedLossCodeChartInstance = new Chart(document.getElementById('detailedLossCodeChart').getContext('2d'), {
                type: 'bar',
                data: { labels: sortedLossAnalysis.map(d => d[0]), datasets: [{ label: 'เวลารวมที่หยุด (ชม.)', data: sortedLossAnalysis.map(d => d[1].toFixed(2)), backgroundColor: ['#f87171', '#fb923c', '#c084fc', '#60a5fa', '#a3e635', '#9ca3af', '#facc15'] }] },
                options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } }, scales: { x: { title: { display: true, text: 'ชั่วโมง' } } } }
            });
            
            const trayTransportHours = detailedLossAnalysis['การขนถาด'] || 0;
            const trayTransportPercentage = totalLossHoursJuly > 0 ? (trayTransportHours / totalLossHoursJuly * 100).toFixed(1) : 0;
            document.getElementById('loss-analysis-insight').innerHTML = `<p><strong>"การขนถาด"</strong> ยังคงเป็นสาเหตุหลักที่ทำให้เสียเวลามากที่สุด รวมเป็นเวลา <strong>${trayTransportHours.toFixed(2)} ชั่วโมง</strong>, คิดเป็น <strong class="text-red-600">${trayTransportPercentage}%</strong> ของเวลาที่สูญเสียทั้งหมด</p><p class="mt-2">ปัญหาด้านอุปกรณ์ เช่น ไฟดับ และการซ่อมแซมเฉพาะจุด เป็นสาเหตุรองที่ควรได้รับการตรวจสอบและแก้ไขต่อไป</p>`;
            const topLosses = lossEventsJuly.sort((a, b) => timeToHours(b['BD Time']) - timeToHours(a['BD Time'])).slice(0, 5);
            document.getElementById('top-loss-table').innerHTML = topLosses.map(item => `<tr class="border-b border-slate-200 hover:bg-slate-50"><td class="p-2">${item.Date.substring(0,5)}</td><td class="p-2 text-slate-600">${item.Note}</td><td class="p-2 text-right font-semibold text-red-700">${item['BD Time']}</td></tr>`).join('');

            // --- EFFICIENCY ANALYSIS ---
            const calculateCoopAvgTimes = (data) => {
                const avgs = [];
                for (let i = 1; i <= 6; i++) {
                    if (i === 1 && data.some(d => d.Date.includes('/06/2025') || d.Date.includes('/07/2025'))) {
                        avgs.push(0);
                        continue;
                    }
                    const coopData = data.filter(day => timeToHours(day[`H${i}_Oparation`]) > 0);
                    const totalTime = coopData.reduce((sum, day) => sum + timeToHours(day[`H${i}_Oparation`]), 0);
                    avgs.push(coopData.length > 0 ? totalTime / coopData.length : 0);
                }
                return avgs;
            };
            const coopTimeData = { labels: ['H1', 'H2', 'H3', 'H4', 'H5', 'H6'], thisMonth: calculateCoopAvgTimes(julyData), lastMonth: calculateCoopAvgTimes(juneData) };
            
            if (coopTimeChartInstance) coopTimeChartInstance.destroy();
            coopTimeChartInstance = new Chart(document.getElementById('coopTimeChart').getContext('2d'), {
                type: 'bar',
                data: { labels: coopTimeData.labels, datasets: [ { label: 'กรกฎาคม', data: coopTimeData.thisMonth, backgroundColor: '#0d9488' }, { label: 'มิถุนายน', data: coopTimeData.lastMonth, backgroundColor: '#a1a1aa' } ] },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { title: { display: true, text: 'เวลาเฉลี่ย (ชม.)' } } } }
            });

            const totalAvgJuly = coopTimeData.thisMonth.reduce((a, b) => a + b, 0);
            const totalAvgJune = coopTimeData.lastMonth.reduce((a, b) => a + b, 0);
            const improvement = totalAvgJune > 0 ? ((totalAvgJune - totalAvgJuly) / totalAvgJune * 100) : 0;
            document.getElementById('efficiency-insight').innerHTML = `<p>เวลาคัดไข่รวมเฉลี่ยต่อวันในเดือนกรกฎาคมคือ <strong>${totalAvgJuly.toFixed(2)} ชั่วโมง</strong> เทียบกับเดือนมิถุนายนที่ใช้เวลาเฉลี่ย <strong>${totalAvgJune.toFixed(2)} ชั่วโมง</strong></p><p class="mt-2 ${improvement >= 0 ? 'text-green-600' : 'text-red-600'} font-semibold">สรุป: พนักงานทำงานได้เร็วขึ้นโดยรวมประมาณ ${improvement.toFixed(2)}%</p><p class="mt-2 text-sm text-slate-500">หมายเหตุ: ข้อมูลโรงเรือน H1 เป็น 0 เนื่องจากไก่ถูกปลดแล้ว</p>`;
        }

        // --- INITIAL RENDER ---
        document.addEventListener('DOMContentLoaded', fetchDataAndRender);
    </script>
</body>
</html>
